---
title: SwiftUI核心技术第12章Dark Mode和Accessibility
date: 2023-11-08 09:33:25
categories:
- SwiftUI
tags:
---
**第12章：Dark Mode和Accessibility**

**第1小节：支持暗黑模式**

随着用户对于在不同光照条件下使用设备的需求增加，暗黑模式（Dark Mode）成为了现代应用设计不可或缺的一部分。它不仅有助于减少在低光环境下使用设备时的眼睛疲劳，还能为电池续航带来好处，特别是在OLED屏幕上。此外，暗黑模式还能为用户提供一个更为集中和减少分心的视觉环境。

### 理解暗黑模式

1. **色彩转换** - 暗黑模式不仅仅是将背景设置为黑色和文本设置为白色那么简单。它涉及到色彩配色的整体调整，以确保可读性、可访问性和品牌一致性。

2. **图层和深度** - 暗色背景提升了颜色对比，这意味着阴影和高亮可以用来模拟层次感和深度。

3. **用户控制** - 用户应当能够选择在明亮或暗黑模式下使用应用，或让应用跟随系统设置自动切换。

### 设计指南

1. **颜色主题** - 定义一套色彩主题，包括在暗黑模式下使用的色彩。应使用较亮的色调和透明度来增加层次感，同时避免使用纯白色，以减少对比度导致的刺眼感。

2. **组件和控件** - 确保所有UI组件和控件在暗黑模式下都是可见的，并且它们的状态（如激活、禁用）在两种模式下都清晰。

3. **图片和媒体** - 对于暗黑模式，应考虑使用较暗的图片和插图，或者为图片添加蒙版或过滤器，以适应暗背景。

4. **文本对比度** - 文本应当足够对比，以确保在暗背景下的可读性。对于文本阴影和轮廓也应进行调整。

### 技术实现

1. **Asset Catalogs** - 在Xcode的Asset Catalogs中，可以为每种颜色定义亮色和暗色两个版本。

2. **CSS支持** - 在Web内容中，可以使用CSS的`prefers-color-scheme`查询来为网页添加暗黑模式支持。

3. **SwiftUI** - 在SwiftUI中，可以通过`.environment(\.colorScheme, .dark)`为预览添加暗黑模式的支持。对于动态颜色，可以使用`Color`结构体内置的暗黑模式适配。

4. **UIKit** - 在UIKit中，可以使用`traitCollection.userInterfaceStyle`来检查当前的界面风格，并在需要时调整UI元素的样式。

### 最佳实践

1. **测试** - 在两种模式下都对应用进行全面的测试，确保UI元素的可见性和功能的可用性。

2. **用户设置** - 提供设置选项，允许用户根据个人喜好切换模式。

3. **跟随系统** - 默认情况下，应用应当跟随系统的暗黑模式设置，以保持用户体验的一致性。

4. **节能考量** - 利用暗黑模式的节能优势，在OLED屏幕上通过使用更多真正的黑色来减少能耗。

5. **无障碍** - 确保暗黑模

式下的色彩对比满足无障碍标准，以便色弱和视力障碍用户也能舒适使用。

通过以上的设计和技术实现指南，开发者可以为其应用成功地集成暗黑模式，不仅提高了应用的美观性，同时也照顾到了用户的实际使用需求和舒适度。


**第2小节：辅助功能的最佳实践**

辅助功能（Accessibility）是确保所有用户，包括那些有视力、听力、运动或学习障碍的人，能够有效使用你的应用的关键组成部分。对于应用开发者来说，这不仅仅是一项法律义务或道德责任，更是一种设计上的优秀实践，它能够扩大应用的潜在用户群体，并提升用户体验。

### 认识辅助功能的范畴

1. **多感官接入** - 保证信息的传递不仅限于一种感官，例如，对于视觉信息，提供文本描述或声音解释。

2. **易用性** - 确保应用的操作简单明了，尤其是对于运动障碍用户，考虑到触摸目标的大小和屏幕的可达性。

3. **可见性** - 包含字体大小的调整、高对比度模式以及颜色不是传达重要信息的唯一方式。

4. **认知考虑** - 设计简洁、一致的界面，减少认知负担，特别是为了那些有认知障碍的用户。

### 设计指南

1. **文本可读性** - 提供文本大小调整的功能，支持系统级别的“辅助功能”设置。

2. **高对比度** - 提供高对比度主题或模式，辅以清晰的字体，帮助视觉障碍用户更好地识别内容。

3. **颜色盲友好** - 设计UI时不要完全依赖颜色来区分元素或传达信息，使用图形符号或标签作为辅助。

4. **标签和说明** - 所有的交互控件都应该有清晰的标签，辅以适当的声音或触觉反馈。

5. **语音控制** - 支持通过语音命令进行控制，为那些无法使用传统输入设备的用户提供便利。

### 技术实现

1. **VoiceOver/Speak Screen** - 确保SwiftUI或UIKit组件正确实现了辅助功能标签和行为，以便VoiceOver能够读取屏幕上的内容。

2. **动态字体大小** - 使用`UIFont.preferredFont(forTextStyle:)`和SwiftUI中的`.font(.system(size:))`来响应用户的字体大小设置。

3. **UIAccessibility协议** - 通过实现相关的UIAccessibility协议来自定义非标准UI组件的辅助功能行为。

4. **辅助功能快捷方式** - 通过设置快捷方式让用户能够快速访问常用的辅助功能。

### 最佳实践

1. **持续测试** - 在开发过程中，经常使用辅助功能进行测试，确保所有用户在使用应用时的体验一致。

2. **社群参与** - 与残障社群合作，获取真实的反馈，并根据这些反馈改进产品。

3. **遵循标准** - 遵循WCAG（Web Content Accessibility Guidelines）等国际标准来设计和开发应用。

4. **教育和文档** - 提供有关如何使用应用中辅助功能的文档或视频教程。

5. **UI测试和自动化** - 利用自动化测试框架来验证辅助功能的实现，确保在应用更新后功能依然可用。

通过实施这些最

佳实践，开发者不仅能够提供一个包容性更强的应用体验，同时也能满足日益增长的多样化用户需求，构建起更加广泛的用户基础。


**第3小节：动态字体与国际化**

设计一个能够轻松适应不同语言和区域设置的用户界面，以及支持动态字体大小调整，是为了确保应用能够覆盖更广泛的用户群体，特别是那些有特定阅读需求的用户。

### 动态字体的重要性

动态字体允许用户根据自己的视力需求来调整字体的大小。这对于那些需要辅助设备阅读的用户尤为重要。

### 实现动态字体

1. **使用系统字体尺寸** - 利用系统提供的字体大小，如在SwiftUI中使用`.font(.system(size:))`。

2. **响应用户设置** - 应用应该能够响应并遵循用户的辅助功能设置，比如“更大字体”选项。

3. **字体可伸缩性** - 保证应用的布局可以适应不同的字体大小而不会破坏界面设计。

4. **自定义字体的辅助功能** - 如果使用自定义字体，确保它们能够与系统的辅助功能设置兼容，如使用`UIFontMetrics`来调整。

### 国际化的挑战

国际化不仅仅是将文本翻译成不同的语言，还需要考虑到文化差异、布局方向（例如从右到左的语言）、日期和时间格式以及货币单位。

### 实现国际化

1. **本地化字符串** - 使用本地化字符串文件（`.strings`）和键值对来管理应用中的文本。

2. **自适应布局** - 确保UI能够适应不同的文本长度和布局方向。

3. **日期和数字格式** - 使用`DateFormatter`和`NumberFormatter`来处理日期和数字的本地化格式。

4. **资源的国际化** - 包括图像等资源的国际化，确保它们在不同文化中同样适用。

### 最佳实践

1. **全面测试** - 在不同的语言和辅助功能设置下测试应用，确保所有功能正常工作。

2. **持续的本地化和国际化** - 让本地化和国际化成为开发流程的一部分，不断更新和完善。

3. **伪本地化测试** - 使用伪本地化来测试应用的布局是否能够适应文字长度的变化。

4. **文化敏感性** - 在设计和开发应用时，考虑到不同文化背景下的用户需求和习俗。

5. **动态字体和布局测试** - 使用Xcode中的辅助功能检查器来预览应用在不同字体大小下的表现。

通过实施这些策略，开发者可以确保他们的应用不仅在不同地区和文化中使用无障碍，而且可以为所有用户提供一个更加个性化和易于使用的体验。